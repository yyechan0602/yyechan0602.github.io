---
title:  "[Docker] ğŸ‹ Spring ì„œë²„ë¥¼ Dockerë¡œ ë„ìš°ê¸°"
excerpt: "Docker CS ì§€ì‹ ì •ë¦¬"
categories:
  - Docker
tags:
  - [CS, Docker]

toc: true
toc_sticky: true
 
date: 2024-01-31
last_modified_at: 2024-01-31
---

## ğŸ“– SpringBoot Server

ì—°ìŠµì„ ìœ„í•˜ì—¬ ê°„ë‹¨í•˜ê²Œ `demo/hello` APIì™€ getí˜•ì‹ì˜ `demo/demo`ë¥¼ ê°€ì§€ê³  ìˆëŠ” `Demo Server`ë¥¼ ì˜¬ë ¸ë‹¤.  
ìŠ¤í”„ë§ë¶€íŠ¸ëŠ” IntelliJì—ì„œ ì§„í–‰í•  ì˜ˆì •ì´ë©°, ìë°”ëŠ” `JDK-17`/ ìŠ¤í”„ë§ë¶€íŠ¸ ë²„ì „ì€ `3.2.2`ì„ ì‚¬ìš©í•˜ì˜€ë‹¤.  

![image](https://github.com/yyechan0602/yyechan0602.github.io/assets/37824506/8d5414b8-b467-41f8-89b4-be6dfaa1bba5)

![image](https://github.com/yyechan0602/yyechan0602.github.io/assets/37824506/651d6cf4-6d82-4cd6-af84-8261705c2167)

ìœ„ì™€ ê°™ì´ í”„ë¡œì íŠ¸ë¥¼ ë§Œë“¤ì–´ ì£¼ì—ˆë‹¤.  
ì•„ë˜ëŠ” MVCëª¨ë¸ë¡œ êµ¬í˜„í•œ ì†ŒìŠ¤ì½”ë“œì´ë‹¤.  

<br>

### ğŸ„ ì†ŒìŠ¤ ì½”ë“œ

<details>
<summary>Controller</summary>
<div markdown="1">

```java
package com.example.demo.Controller;

import com.example.demo.Service.DemoService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
@RequestMapping("demo")
public class DemoController {

    private final DemoService demoService;

    @Autowired
    public DemoController(DemoService demoService) {
        this.demoService = demoService;
    }

    @RequestMapping("/hello")
    public String hello() {
        return "hello";
    }

    @GetMapping()
    public String getName(int index) {
        System.out.println(index);
        return demoService.DemoDTO(index);
    }
}
```

</div>
</details>

<br>

<details>
<summary>DTO</summary>
<div markdown="1">

```java
package com.example.demo.DTO;

public class DemoDTO {
    String name;

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }
}

```

</div>
</details>

<br>

<details>
<summary>Entity</summary>
<div markdown="1">

```java
package com.example.demo.entity;

import jakarta.persistence.*;
import lombok.AllArgsConstructor;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;

@Entity
@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
@Table(name = "Demo")
public class Demo {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private int index;

    @Column(nullable = false)
    private String name;
}

```

</div>
</details>

<br>

<details>
<summary>Repository</summary>
<div markdown="1">

```java
package com.example.demo.Repository;

import com.example.demo.DTO.DemoDTO;
import com.example.demo.entity.Demo;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

@Repository
public interface DemoRepository extends JpaRepository<Demo, Integer> {
}

```

</div>
</details>

<br>

<details>
<summary>Service</summary>
<div markdown="1">

```java
package com.example.demo.Service;

import com.example.demo.DTO.DemoDTO;
import com.example.demo.Repository.DemoRepository;
import com.example.demo.entity.Demo;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Repository;
import org.springframework.stereotype.Service;

@Service
public class DemoService {
    private final DemoRepository demoRepository;

    @Autowired
    public DemoService(DemoRepository demoRepository) {
        this.demoRepository = demoRepository;
    }

    public String DemoDTO(int index) {
        Demo demo = demoRepository.findById(index).get();

        return demo.getName();
    }
}
```

</div>
</details>  

<details>
<summary>Repository</summary>
<div markdown="1">

```java
package com.example.demo.Repository;

import com.example.demo.DTO.DemoDTO;
import com.example.demo.entity.Demo;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

@Repository
public interface DemoRepository extends JpaRepository<Demo, Integer> {
}

```

</div>
</details>

<br>

<details>
<summary>application.yml</summary>
<div markdown="1">

ê¸°ì¡´ì— ìˆë˜ application.properties íŒŒì¼ì„ ì‚­ì œí•˜ê³ , application.ymlë¡œ ë³€ê²½í•´ì£¼ì—ˆë‹¤.  

```java
spring:
  datasource:
    url: jdbc:mariadb://host.docker.internal:3306/demo
    driver-class-name: org.mariadb.jdbc.Driver
    username: 'root'
    password: '1234'
  jpa:
    open-in-view: false
    generate-ddl: true
    show-sql: true
    hibernate:
      ddl-auto: update
  application:
    name: demo
  profiles:
    active: dev

server:
  port: 8080

```

</div>
</details>

<br>

<details>
<summary>application.yml</summary>
<div markdown="1">

ê¸°ì¡´ì— ìˆë˜ application.properties íŒŒì¼ì„ ì‚­ì œí•˜ê³ , application.ymlë¡œ ë³€ê²½í•´ì£¼ì—ˆë‹¤.  

```yml
spring:
  datasource:
    url: jdbc:mariadb://host.docker.internal:3306/demo
    driver-class-name: org.mariadb.jdbc.Driver
    username: 'root'
    password: '1234'
  jpa:
    open-in-view: false
    generate-ddl: true
    show-sql: true
    hibernate:
      ddl-auto: update
  application:
    name: demo
  profiles:
    active: dev

server:
  port: 8080

```

</div>
</details>

<br>

<details>
<summary>ì˜ì¡´ì„± ì£¼ì…</summary>
<div markdown="1">

build.gradleì— ìˆëŠ” dependencies 

```
//swagger
    implementation 'org.springdoc:springdoc-openapi-starter-webmvc-ui:2.0.2'
    //Database
    runtimeOnly 'org.mariadb.jdbc:mariadb-java-client' // MariaDB
```

</div>
</details>

<br>

## ğŸ“– docker ì´ë¯¸ì§€ ë§Œë“¤ê¸°

ì•„ë˜ì™€ ê°™ì´ ì˜¤ë¥¸ìª½ì˜ Gradle í•­ëª©ì—ì„œ `build/bootJar`ì„ í´ë¦­í•˜ì—¬ íŒŒì¼ ë¹Œë“œë¥¼ í•´ì¤€ë‹¤.  
ê·¸ëŸ¬ë©´ `build/libs` ì•„ë˜ì— `.jar`íŒŒì¼ì´ ìƒì„±ë˜ê²Œ ëœë‹¤.  

![image](https://github.com/yyechan0602/yyechan0602.github.io/assets/37824506/d0103143-e104-4483-a17b-aa2a4765e7fc)

`dockerfile`ì´ë¼ëŠ” ì´ë¦„ì˜ íŒŒì¼ì„ í”„ë¡œì íŠ¸ rootí´ë” ì•„ë˜ì— ë§Œë“¤ì–´ì¤€ë‹¤.  
ì•„ë˜ì™€ ê°™ì´ ë‚´ìš©ì„ ì ì–´ì¤€ë‹¤.  

- dockerfile
```dockerfile
FROM openjdk:11
ARG JAR_FILE=*.jar
COPY ${JAR_FILE} app.jar
ENTRYPOINT ["java","-jar","/app.jar"]
```

<br>

### ğŸ„ ì‹¤ìŠµ

ì•„ë˜ì™€ ê°™ì´ í•˜ë©´ ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•´ì£¼ê³ , `Docker Hub`ì— ì´ë¥¼ ì˜¬ë¦°ë‹¤.  

```
docker build -t [ë„ì»¤í—ˆë¸Œ ID]/[Repository ì´ë¦„] .
docker push [ë„ì»¤í—ˆë¸Œ ID]/[Repository ì´ë¦„]
```

ì•„ë˜ì™€ ê°™ì´ `docker Hub`ì—ì„œ ì´ë¯¸ì§€ë¥¼ ë‹¤ìš´ë°›ì•„ì„œ ì‹¤í–‰ì‹œì¼°ë‹¤.  

```
docker run -d -i -p 8080:8080 [ë„ì»¤ í—ˆë¸Œ ID/ì´ë¯¸ì§€ ì´ë¦„]
```

ì•„ë˜ëŠ” ì‹¤í–‰ í™”ë©´ë“¤ì´ë‹¤.  

![demo](https://github.com/yyechan0602/yyechan0602.github.io/assets/37824506/1ff74e51-60cc-468a-97e1-4fb44dbfd12e)


![swagger](https://github.com/yyechan0602/yyechan0602.github.io/assets/37824506/90f4be09-c230-43c5-be28-2c5f4c59fdef)

![get](https://github.com/yyechan0602/yyechan0602.github.io/assets/37824506/369e0500-eb05-449e-866c-1d754bb6cbf2)

<br>

## ğŸ“– ë©€í‹° ìŠ¤í…Œì´ì§€ë¥¼ í†µí•´ ì´ë¯¸ì§€ ë§Œë“¤ê¸°

ê¸°ì¡´ê³¼ ë™ì¼í•œ ì½”ë“œì—ì„œ `Dockerfile`ì„ ë³€ê²½í•´ì£¼ë©´ ëœë‹¤.  

```
# build
FROM gradle:8.5 AS builder
WORKDIR /build

COPY build.gradle settings.gradle /build/
RUN gradle build -x test --parallel --continue > /dev/null 2>&1 || true

COPY . /build
RUN gradle build -x test --parallel


# app
FROM openjdk:17

WORKDIR /app

COPY --from=builder /build/build/libs/*-SNAPSHOT.jar ./app.jar

ENTRYPOINT ["java","-jar","app.jar"]

EXPOSE 8080
```

ì´ë•Œ, builderì˜ ë²„ì „ì„ í™•ì¸í•´ ì£¼ì–´ì•¼ í•˜ëŠ”ë°, ì´ëŠ” `gradle/wrapper/gradle-wrapper.properties` íŒŒì¼ì— ìˆëŠ” `distributionUrl`ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.  

<br>

### ğŸ„ ì‹¤ìŠµ

```
docker build -t [ë„ì»¤í—ˆë¸Œ ID]/[Repository ì´ë¦„] .
docker push [ë„ì»¤í—ˆë¸Œ ID]/[Repository ì´ë¦„]
```

ê¸°ì¡´ê³¼ ë˜‘ê°™ì´ build í›„ pushí•´ì£¼ì—ˆë‹¤.  
ê¸°ì¡´ê³¼ ë‹¬ë¼ì§„ ì ì€ Dockerfileì—ì„œ í™˜ê²½ì„ ë§Œë“¤ì–´ì£¼ê¸° ë•Œë¬¸ì—, `bootJar`ë¥¼ ì‹¤í–‰ì‹œì¼œì¤„ í•„ìš”ëŠ” ì—†ë‹¤.  

```
docker run -d -i -p 8080:8080 [ë„ì»¤ í—ˆë¸Œ ID/ì´ë¯¸ì§€ ì´ë¦„]
```

ì´ì „ê³¼ ê°™ì´ ì˜ ì‘ë™í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.  

<br>

***
    ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤.
    í‹€ë¦¬ê±°ë‚˜ ì˜¤ë¥˜ê°€ ìˆì„ ê²½ìš° ì œë³´í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤.ğŸ˜